<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Profile</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f3f4f6;
        }

        /* Styling for Django form fields wrapped in <p> tags */
        form p {
            margin-bottom: 1rem;
        }

        form p label {
            display: block;
            font-weight: 500;
            color: #4B5563; /* Gray-600 */
            margin-bottom: 0.25rem;
        }

        form p input[type="text"],
        form p input[type="email"],
        form p input[type="number"],
        form p input[type="tel"],
        form p input[type="url"],
        form p textarea,
        form p select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #D1D5DB; /* Gray-300 */
            border-radius: 0.5rem;
            background-color: #F9FAFB; /* Gray-50 */
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        /* Hide file input but keep it functional */
        #id_profile_picture {
            display: none;
        }

        form p input:focus,
        form p textarea:focus,
        form p select:focus,
        form p input[type="file"]:focus {
            outline: none;
            border-color: #34D399; /* Emerald-400 */
            box-shadow: 0 0 0 3px rgba(52, 211, 153, 0.5); /* Emerald-400 with opacity */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="max-w-xl w-full bg-white rounded-xl shadow-lg p-6 md:p-8">
        <!-- Header -->
        <header class="text-center mb-6">
            <h2 class="text-3xl font-extrabold text-gray-800">Update Profile</h2>
            <p class="mt-2 text-gray-500">Edit your personal information and profile picture.</p>
        </header>
        
        <!-- Form for Profile Update, including Photo -->
        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            <!-- Profile Picture Section -->
            <div class="flex flex-col items-center space-y-4 mb-6 pb-6 border-b border-gray-200">
                <span class="block text-gray-700 text-sm font-semibold">Profile Photo</span>

                <!-- Clickable Profile Image -->
                <label for="id_profile_picture" class="relative w-32 h-32 rounded-full overflow-hidden border-4 border-emerald-500 shadow-lg group cursor-pointer">
                    <img id="profile-preview" 
                        src="{{ user.profile.profile_picture.url|default:'https://placehold.co/128x128/e0e7ff/3f51b5?text=Avatar' }}" 
                        alt="Profile Picture" 
                        class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-50 flex flex-col items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <svg class="w-8 h-8 text-white mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 9a2 2 0 012-2h.93a2 2 0 
                                001.664-.89l.865-1.297A2 2 0 
                                0111.33 4h1.34a2 2 0 
                                011.664.89l.865 1.297A2 2 0 
                                0018.07 7H19a2 2 0 
                                012 2v9a2 2 0 
                                01-2 2H5a2 2 0 
                                01-2-2V9z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 13a3 3 0 
                                11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <span class="text-white text-xs font-medium">Click to change</span>
                    </div>
                </label>

                <!-- Hidden File Input -->
                {{ form.image }}

                <p class="text-sm text-gray-500 mt-2">Max file size: 2MB. JPG, PNG allowed.</p>
            </div>

            <!-- Other Form Fields -->
            <div class="space-y-4">
                {% for field in form %}
                    {% if field.name != 'profile_picture' %}
                        <p>
                            {{ field.label_tag }}
                            {{ field }}
                            {% if field.help_text %}
                                <span class="text-sm text-gray-500">{{ field.help_text }}</span>
                            {% endif %}
                            {% for error in field.errors %}
                                <span class="text-red-500 text-sm">{{ error }}</span>
                            {% endfor %}
                        </p>
                    {% endif %}
                {% endfor %}
            </div>

            <button type="submit" class="w-full inline-flex items-center justify-center px-6 py-3 border border-transparent rounded-lg shadow-sm text-base font-medium text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 transition-colors">
                Update Profile
            </button>
        </form>
    </div>

    <script>
        // Preview uploaded image
        const profilePictureInput = document.getElementById('id_profile_picture');
        const profilePreview = document.getElementById('profile-preview');

        if (profilePictureInput && profilePreview) {
            profilePictureInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        profilePreview.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                } else {
                    // Reset if no file is selected
                    profilePreview.src = "{{ user.profile.profile_picture.url|default:'https://placehold.co/128x128/e0e7ff/3f51b5?text=Avatar' }}";
                }
            });
        }
    </script>
</body>
</html>
